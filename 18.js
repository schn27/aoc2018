"use strict";

function calc() {
	let state = input.split("\n").map(line => line.split(""));

	let scores = [];

	const base = 500;	// a minute inside a scores' loop (guess)
	const maxSize = 100;	// maximum loop size (guess)

	for (let i = 0; i < base + maxSize; ++i) {
		state = nextState(state);
		scores.push(state.reduce((a, r) => a + r.filter(e => e == "|").length, 0) * state.reduce((a, r) => a + r.filter(e => e == "#").length, 0));
	}

	let part1 = scores[9];

	let part2 = scores[base + (1000000000 - base) % (scores.indexOf(scores[base], base + 1) - base) - 1];	// find a loop and calculate the final score

	return `${part1} ${part2}`;
}

function nextState(state) {
	let next = state.slice().map(line => line.slice());

	for (let y = 0; y < next.length; ++y) {
		for (let x = 0; x < next[y].length; ++x) {
			const neighbours = [state[y][x - 1], state[y][x + 1], 
							(state[y - 1] || [])[x - 1], (state[y - 1] || [])[x], (state[y - 1] || [])[x + 1], 
							(state[y + 1] || [])[x - 1], (state[y + 1] || [])[x], (state[y + 1] || [])[x + 1]];

			const lumberyards = neighbours.filter(e => e == "#").length;
			const trees = neighbours.filter(e => e == "|").length;

			next[y][x] = state[y][x];

			if (state[y][x] == "." && trees >= 3) {
				next[y][x] = "|";
			}

			if (state[y][x] == "|" && lumberyards >= 3) {
				next[y][x] = "#";
			}

			if (state[y][x] == "#" && (lumberyards == 0 || trees == 0)) {
				next[y][x] = ".";
			}
		}
	}

	return next;
}

const test = `.#.#...|#.
.....#|##|
.|..|...#.
..|#.....#
#.#|||#|#|
...#.||...
.|....|...
||...#|.#|
|.||||..|.
...#.|..|.`;

const input = `|.|.##|....|#|.#...#.|#.#.....|..#..#|.#..|##.##.|
.|....|.#|.#..|#|..#.|.....#....##.||..#......||.#
|.|...|#..|....#..#.......#......#..#|#|..||.|....
..|||#..#.#||.#..#......||.|#...#.#.|..||.#..|.#||
#.##....##.#|........||..#||#.##.#.|||...|#..|||.#
..#||.#......#||..|.#.##..|##..|#...#|...#......|.
|##.#|#...|||####.##....|.....#....#######.......#
.##..#.......|.#.#|##...|..##......#..|.#..#.#|..#
###..###|#..|.#.#..|.#........|.#||.......#.||||..
|.....|.....|##..|..||.......#|#.#.##.#.##..|.....
|#..|#......|##.......##.|#.|.#......#.|#...|.|..|
..|...##..#..|#.|||##...|.||..|||||||||........#..
#......##...|##|.##..|...........#|.#....#..#.....
.|#..#..|..##.#.||..||....#|##...|#..|.#.........#
......|||.#..........#..|....#|.#|||..||...#...#..
|..#.#|....||.|#.#.|.##.|.||.|#.||..||.|..|..|||..
..#........#.........|..|||.......#..#..#..#||..#|
#..#|..#.....#..###..#||..##..........##......#..|
||......|##....|..|.##....||.|.||.#....|.|...#|.|.
.#|.#.#...|#..#.####..||#.|..|##|.....||.#..||.#..
#.#..........#......#....#..|.#....||.#||.|..|#.||
|###............|#....|.........#.....|###|.....|#
#||...|..|.||..#..|.....#.#..||....#.|##...||.##.#
...|......|.|.|...|#...#|.##..||.|.|.#|....#...##|
.|#....#....#.....#...#...||#|.|...#..|..|###..#..
...#...#|.#.|..#.....|..#..|...#|.....|||..#.|..#|
..|....|..||.....|.#.|.#.||.|.|...|||||.||.....|..
.|...|...|......#|.#...#|..#.|...##.#....#...#..|#
..|||##..#...|.####..|...#.#...|..|#.......||..|.|
..#....#|.|....#...|#|.|||||#####....||.#....|...#
|#..|##..#.....||.##....|...||.....|#....#.#..|..#
#..|#.|||#.#..#|......||#.##..#|#.|..#|.|#|.|.....
....#...#.|.......|....#.#....|...#.|..|#.#.....#.
###..#....|#.|.#.||.##|..#...#..#.|#.|.#.##......|
..#..|##.|.|.|....||....##.|||.#...#.|........#...
.|..#.......|#...#||.|...#..#.#........#.|.##|.#|.
..|||#..|.....#.....##......|...|.|#.|..#..||...#.
..|#.#...##...#.#.|...||.||..|||#..#......|..|##..
.|..#||##|...|..|...||.||#..#||.|##...#....|..|..|
|...||....#.|........||.#..|.|.|..##.#.##.#....#|.
.....#.....|.#...|.#..|.#|..|...#|..|....|.|...|.|
|...|....|......|||...##...|..#.#.#...|........###
##.#......#.......||.#....#.#.....|....|..##.|.##.
|.#.#|......#.......|..#.|...###.||......|#.|....|
#|.||.|.....||.#.|..|..##|.|.#...#..|.##.|....#.#.
||..||.|..#....#..#....|#.........#|...#.||#|#|.|.
|.#..|....#.|#|..#.....|##.|......#.#....#|#.#.#.#
##..||.#|...#...|.#|.|..#|#...|.#..|...|....#.#.#|
.#..#......|.#.#|##.|#........###....##..|.......#
.|.#.#.#||.#...#|..#...............#..#...||##....`;
